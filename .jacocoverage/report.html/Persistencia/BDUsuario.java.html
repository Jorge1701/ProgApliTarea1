<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BDUsuario.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Tarea1&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Persistencia</a> &gt; <span class="el_source">BDUsuario.java</span></div><h1>BDUsuario.java</h1><pre class="source lang-java linenums">package Persistencia;

import Logica.DtArtista;
import Logica.DtUsuario;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

<span class="fc" id="L13">public class BDUsuario {</span>

<span class="fc" id="L15">    protected Connection conexion = new ConexionBD().getConexion();</span>

    protected String obtenerCorreo(String nick) {
        try {
<span class="nc" id="L19">            String res = &quot;&quot;;</span>

<span class="nc" id="L21">            PreparedStatement correo = conexion.prepareStatement(&quot;SELECT correo FROM usuario WHERE nickname = '&quot; + nick + &quot;'&quot;);</span>
<span class="nc" id="L22">            ResultSet c = correo.executeQuery();</span>
<span class="nc bnc" id="L23" title="All 2 branches missed.">            while (c.next()) {</span>
<span class="nc" id="L24">                res = c.getString(&quot;correo&quot;);</span>
            }
<span class="nc" id="L26">            c.close();</span>
<span class="nc" id="L27">            correo.close();</span>

<span class="nc" id="L29">            return res;</span>
<span class="nc" id="L30">        } catch (SQLException ex) {</span>
<span class="nc" id="L31">            ex.printStackTrace();</span>
        }

<span class="nc" id="L34">        return &quot;&quot;;</span>
    }

    public boolean seguirUsuario(String nickname_c, String nickname_u) {
        try {
<span class="fc" id="L39">            PreparedStatement insert = conexion.prepareStatement(&quot;INSERT INTO seguir_usuario VALUES (?,?) &quot;);</span>
<span class="fc" id="L40">            insert.setString(1, nickname_c);</span>
<span class="fc" id="L41">            insert.setString(2, nickname_u);</span>
<span class="fc" id="L42">            insert.executeUpdate();</span>
<span class="fc" id="L43">            insert.close();</span>

<span class="fc" id="L45">            return true;</span>
<span class="nc" id="L46">        } catch (SQLException ex) {</span>
<span class="nc" id="L47">            ex.printStackTrace();</span>
<span class="nc" id="L48">            return false;</span>
        }
    }

    public boolean dejarDeSeguir(String nickname_c, String nickname_u) {
        try {
<span class="nc" id="L54">            PreparedStatement delete = conexion.prepareStatement(&quot;DELETE FROM seguir_usuario WHERE nickname_c = ? AND nickname_u = ?&quot;);</span>
<span class="nc" id="L55">            delete.setString(1, nickname_c);</span>
<span class="nc" id="L56">            delete.setString(2, nickname_u);</span>
<span class="nc" id="L57">            delete.executeUpdate();</span>
<span class="nc" id="L58">            delete.close();</span>

<span class="nc" id="L60">            return true;</span>
<span class="nc" id="L61">        } catch (SQLException ex) {</span>
<span class="nc" id="L62">            ex.printStackTrace();</span>
<span class="nc" id="L63">            return false;</span>
        }
    }

    public boolean ingresarUsuario(DtUsuario dtu) {

<span class="fc" id="L69">        String nickName = dtu.getNickname();</span>
<span class="fc" id="L70">        String nombre = dtu.getNombre();</span>
<span class="fc" id="L71">        String apellido = dtu.getApellido();</span>
<span class="fc" id="L72">        String correo = dtu.getEmail();</span>
<span class="fc" id="L73">        String imagen = dtu.getImagen();</span>

<span class="fc" id="L75">        Date fecha = java.sql.Date.valueOf(dtu.getFechaNac().getAnio() + &quot;-&quot; + dtu.getFechaNac().getMes() + &quot;-&quot; + dtu.getFechaNac().getDia());</span>
        //new Date(dtu.getFechaNac().getAnio(), dtu.getFechaNac().getMes(), dtu.getFechaNac().getDia());

<span class="fc bfc" id="L78" title="All 2 branches covered.">        if (dtu instanceof DtArtista) {</span>
            try {
<span class="fc" id="L80">                String biografia = ((DtArtista) dtu).getBiografia();</span>
<span class="fc" id="L81">                String web = ((DtArtista) dtu).getWeb();</span>

<span class="fc" id="L83">                PreparedStatement insertar = conexion.prepareStatement(&quot;INSERT INTO artista &quot;</span>
                        + &quot;(nickname, nombre, apellido,correo,fecha_nac,biografia,sitio_web,imagen) values(?,?,?,?,?,?,?,?)&quot;);
<span class="fc" id="L85">                insertar.setString(1, nickName);</span>
<span class="fc" id="L86">                insertar.setString(2, nombre);</span>
<span class="fc" id="L87">                insertar.setString(3, apellido);</span>
<span class="fc" id="L88">                insertar.setString(4, correo);</span>
<span class="fc" id="L89">                insertar.setDate(5, fecha);</span>
<span class="fc" id="L90">                insertar.setString(6, biografia);</span>
<span class="fc" id="L91">                insertar.setString(7, web);</span>
                // if (imagen == null || imagen == &quot;&quot;) {
                //     insertar.setNull(8, Types.VARCHAR);
                // } else {
<span class="fc" id="L95">                insertar.setString(8, imagen);</span>
                // }
<span class="fc" id="L97">                insertar.executeUpdate();</span>
<span class="fc" id="L98">                insertar.close();</span>
<span class="nc" id="L99">            } catch (SQLException ex) {</span>
<span class="nc" id="L100">                Logger.getLogger(BDUsuario.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L101">                return false;</span>
<span class="fc" id="L102">            }</span>

        } else {
            
            try {
<span class="fc" id="L107">                PreparedStatement insertar = conexion.prepareStatement(&quot;INSERT INTO cliente &quot;</span>
                        + &quot;(nickname, correo, nombre, apellido, fecha_nac,imagen) values(?,?,?,?,?,?)&quot;);
<span class="fc" id="L109">                insertar.setString(1, nickName);</span>
<span class="fc" id="L110">                insertar.setString(2, nombre);</span>
<span class="fc" id="L111">                insertar.setString(3, apellido);</span>
<span class="fc" id="L112">                insertar.setString(4, correo);</span>
<span class="fc" id="L113">                insertar.setDate(5, fecha);</span>
                //if (imagen == null || imagen == &quot;&quot;) {
                //    insertar.setNull(6, Types.VARCHAR);
                // } else {
<span class="fc" id="L117">                insertar.setString(6, imagen);</span>
                //}
<span class="fc" id="L119">                insertar.executeUpdate();</span>
<span class="fc" id="L120">                insertar.close();</span>
<span class="nc" id="L121">            } catch (SQLException ex) {</span>
<span class="nc" id="L122">                Logger.getLogger(BDUsuario.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L123">                return false;</span>
<span class="fc" id="L124">            }</span>
        }
<span class="fc" id="L126">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>