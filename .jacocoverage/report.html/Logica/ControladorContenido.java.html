<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ControladorContenido.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Tarea1&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Logica</a> &gt; <span class="el_source">ControladorContenido.java</span></div><h1>ControladorContenido.java</h1><pre class="source lang-java linenums">package Logica;

//import Persistencia.BDUsuario;
import Persistencia.BDCliente;
import Persistencia.BDGenero;
import Persistencia.BDLista;
import Persistencia.CargaDatosPrueba;
import java.util.HashMap;
import java.util.Map;
import java.util.ArrayList;
import java.util.Iterator;

public class ControladorContenido implements IContenido {

    private static ControladorContenido instancia;

    public static void cargarInstancia() {
<span class="fc" id="L18">        instancia = new ControladorContenido();</span>
<span class="fc" id="L19">    }</span>

    public static ControladorContenido getInstance() {
<span class="fc bfc" id="L22" title="All 2 branches covered.">        if (instancia == null) {</span>
<span class="fc" id="L23">            cargarInstancia();</span>
        }
<span class="fc" id="L25">        return instancia;</span>
    }

    private final Map&lt;String, ListaDefecto&gt; listasDefecto;
    private final Map&lt;String, ListaParticular&gt; listasParticular;
    private Artista artista;
    private final Genero genero;
    private Genero generoRecordado;
    private Cliente clienteFav;
    private IUsuario iUsuario;

    @Override
    public void setIUsuario(IUsuario iUsuario) {
<span class="fc" id="L38">        this.iUsuario = iUsuario;</span>
<span class="fc" id="L39">    }</span>

<span class="fc" id="L41">    private ControladorContenido() {</span>
<span class="fc" id="L42">        this.listasParticular = new HashMap&lt;&gt;();</span>
<span class="fc" id="L43">        this.listasDefecto = new HashMap&lt;&gt;();</span>
<span class="fc" id="L44">        genero = new Genero(&quot;GÃ©neros&quot;);</span>
<span class="fc" id="L45">    }</span>

    @Override
    public void indicarCliente(String nick) {
<span class="nc" id="L49">        Usuario u = iUsuario.obtenerUsuario(nick);</span>

<span class="nc bnc" id="L51" title="All 2 branches missed.">        if (u == null) {</span>
<span class="nc" id="L52">            throw new UnsupportedOperationException(&quot;Usuario &quot; + nick + &quot; no existe&quot;);</span>
        }

<span class="nc bnc" id="L55" title="All 2 branches missed.">        if (!(u instanceof Cliente)) {</span>
<span class="nc" id="L56">            throw new UnsupportedOperationException(&quot;El usuario &quot; + nick + &quot; debe ser un cliente&quot;);</span>
        }

<span class="nc" id="L59">        clienteFav = (Cliente) u;</span>
<span class="nc" id="L60">    }</span>

    @Override
    public void guardarTema(String nickArtista, String nomAlbum, String nomTema) {
<span class="nc" id="L64">        Usuario u = iUsuario.obtenerUsuario(nickArtista);</span>

<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (u == null) {</span>
<span class="nc" id="L67">            throw new UnsupportedOperationException(&quot;El artista &quot; + nickArtista + &quot; no existe&quot;);</span>
        }

<span class="nc bnc" id="L70" title="All 2 branches missed.">        if (!(u instanceof Artista)) {</span>
<span class="nc" id="L71">            throw new UnsupportedOperationException(&quot;Este usuario &quot; + nickArtista + &quot; debe ser un artista&quot;);</span>
        }

<span class="nc" id="L74">        Album album = ((Artista) u).getAlbum(nomAlbum);</span>

<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (album == null) {</span>
<span class="nc" id="L77">            throw new UnsupportedOperationException(&quot;El artista &quot; + nickArtista + &quot; no tiene ningun album llamado &quot; + nomAlbum);</span>
        }

<span class="nc" id="L80">        Tema tema = album.getTema(nomTema);</span>

<span class="nc bnc" id="L82" title="All 2 branches missed.">        if (tema == null) {</span>
<span class="nc" id="L83">            throw new UnsupportedOperationException(&quot;El album &quot; + nomAlbum + &quot; no tiene ningun tema llamado &quot; + nomTema);</span>
        }

        try {
<span class="nc" id="L87">            BDCliente bdc = new BDCliente();</span>
            //boolean ok = bdc.agregarTemaFav();

            //if (!ok)
            // throw new UnsupportedOperationException(&quot;Error al agregar datos en la base de datos&quot;);
<span class="nc" id="L92">            clienteFav.agregarTemaFav(tema);</span>
<span class="nc" id="L93">            clienteFav = null;</span>
<span class="nc" id="L94">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L95">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L96">        }</span>
<span class="nc" id="L97">    }</span>

    @Override
    public void guardarListaDefault(String nomGenero, String nomLista) {
<span class="nc" id="L101">        Genero g = genero.obtener(nomGenero);</span>

<span class="nc bnc" id="L103" title="All 2 branches missed.">        if (g == null) {</span>
<span class="nc" id="L104">            throw new UnsupportedOperationException(&quot;El genero &quot; + nomGenero + &quot; no existe&quot;);</span>
        }

<span class="nc" id="L107">        ListaDefecto l = g.getListaDefecto(nomLista);</span>

<span class="nc bnc" id="L109" title="All 2 branches missed.">        if (l == null) {</span>
<span class="nc" id="L110">            throw new UnsupportedOperationException(&quot;La lista &quot; + nomLista + &quot; no existe dentro del genero &quot; + nomGenero);</span>
        }

        try {
<span class="nc" id="L114">            BDCliente bdc = new BDCliente();</span>
<span class="nc" id="L115">            boolean ok = bdc.agregarListaDefaultFav(nomGenero, nomLista, clienteFav.getNickname());</span>

<span class="nc bnc" id="L117" title="All 2 branches missed.">            if (!ok) {</span>
<span class="nc" id="L118">                throw new UnsupportedOperationException(&quot;Error al agregar datos en la base de datos&quot;);</span>
            }

<span class="nc" id="L121">            clienteFav.agregarListaFav(l);</span>
<span class="nc" id="L122">            clienteFav = null;</span>
<span class="nc" id="L123">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L124">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L125">        }</span>
<span class="nc" id="L126">    }</span>

    @Override
    public void guardarListaParticular(String nickCliente, String nomLista) {
<span class="nc" id="L130">        Usuario u = iUsuario.obtenerUsuario(nickCliente);</span>

<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (u == null) {</span>
<span class="nc" id="L133">            throw new UnsupportedOperationException(&quot;El cliente &quot; + nickCliente + &quot; no existe&quot;);</span>
        }

<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (!(u instanceof Cliente)) {</span>
<span class="nc" id="L137">            throw new UnsupportedOperationException(&quot;El usuario &quot; + nickCliente + &quot; debe ser un cliente&quot;);</span>
        }

<span class="nc" id="L140">        ListaParticular l = ((Cliente) u).getListaParticular(nomLista);</span>

<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (l == null) {</span>
<span class="nc" id="L143">            throw new UnsupportedOperationException(&quot;El cliente &quot; + nickCliente + &quot; no tinene ninguna lista llamada &quot; + nomLista);</span>
        }

        try {
<span class="nc" id="L147">            BDCliente bdc = new BDCliente();</span>
<span class="nc" id="L148">            boolean ok = bdc.agregarListaParticularFav(nickCliente, nomLista, clienteFav.getNickname());</span>

<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (!ok) {</span>
<span class="nc" id="L151">                throw new UnsupportedOperationException(&quot;Error al agregar datos en la base de datos&quot;);</span>
            }

<span class="nc" id="L154">            clienteFav.agregarListaFav(l);</span>
<span class="nc" id="L155">            clienteFav = null;</span>
<span class="nc" id="L156">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L157">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L158">        }</span>
<span class="nc" id="L159">    }</span>

    @Override
    public void guardarAlbum(String nickArtista, String nomAlbum) {
<span class="nc" id="L163">        Usuario u = iUsuario.obtenerUsuario(nickArtista);</span>

<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (u == null) {</span>
<span class="nc" id="L166">            throw new UnsupportedOperationException(&quot;El artista &quot; + nickArtista + &quot; no existe&quot;);</span>
        }

<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (!(u instanceof Artista)) {</span>
<span class="nc" id="L170">            throw new UnsupportedOperationException(&quot;Este usuario &quot; + nickArtista + &quot; debe ser un artista&quot;);</span>
        }

<span class="nc" id="L173">        Album album = ((Artista) u).getAlbum(nomAlbum);</span>

<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (album == null) {</span>
<span class="nc" id="L176">            throw new UnsupportedOperationException(&quot;El artista &quot; + nickArtista + &quot; no tiene ningun album llamado &quot; + nomAlbum);</span>
        }

        try {
<span class="nc" id="L180">            BDCliente bdc = new BDCliente();</span>
<span class="nc" id="L181">            boolean ok = bdc.agregarAlbumFav(nickArtista, nomAlbum, clienteFav.getNickname());</span>

<span class="nc bnc" id="L183" title="All 2 branches missed.">            if (!ok) {</span>
<span class="nc" id="L184">                throw new UnsupportedOperationException(&quot;Error al agregar datos en la base de datos&quot;);</span>
            }

<span class="nc" id="L187">            clienteFav.agregarAlbumFav(album);</span>
<span class="nc" id="L188">            clienteFav = null;</span>
<span class="nc" id="L189">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L190">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L191">        }</span>
<span class="nc" id="L192">    }</span>

    @Override
    public void eliminarTema(int i) {
        try {
<span class="nc" id="L197">            clienteFav.eliminarTemaFav(i);</span>
<span class="nc" id="L198">            clienteFav = null;</span>
<span class="nc" id="L199">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L200">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L201">        }</span>
<span class="nc" id="L202">    }</span>

    @Override
    public void eliminarListaFavoritos(int i) {
        try {
<span class="nc" id="L207">            clienteFav.eliminarListaFav(i);</span>
<span class="nc" id="L208">            clienteFav = null;</span>
<span class="nc" id="L209">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L210">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L211">        }</span>
<span class="nc" id="L212">    }</span>

    @Override
    public void eliminarAlbum(int i) {
        try {
<span class="nc" id="L217">            clienteFav.eliminarAlbumFav(i);</span>
<span class="nc" id="L218">            clienteFav = null;</span>
<span class="nc" id="L219">        } catch (UnsupportedOperationException e) {</span>
<span class="nc" id="L220">            throw new UnsupportedOperationException(e.getMessage());</span>
<span class="nc" id="L221">        }</span>
<span class="nc" id="L222">    }</span>

    @Override
    public boolean selectArtista(String nick) {
<span class="nc" id="L226">        this.artista = ControladorUsuario.getInstance().selectArtista(nick);</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (this.artista != null) {</span>
<span class="nc" id="L228">            return true;</span>
        } else {
<span class="nc" id="L230">            return false;</span>
        }
    }

    @Override
    public DtGenero listarGenero() {
<span class="nc" id="L236">        return genero.getData();</span>
    }

    @Override
    public ArrayList&lt;DtAlbum&gt; listarAlbumesGenero(String nombre) {
<span class="nc" id="L241">        Genero gen = genero.obtener(nombre);</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (gen == null) {</span>
<span class="nc" id="L243">            throw new UnsupportedOperationException(&quot;Genero no existe&quot;);</span>
        }

<span class="nc" id="L246">        return gen.obtenerAlbumes();</span>
    }

    @Override
    public boolean crearListaReproduccion(DtLista dtl, String nickCliente) {
<span class="nc" id="L251">        BDLista bdLista = new BDLista();</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (dtl instanceof DtListaDefecto) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">            if (listasDefecto.get(dtl.getNombre()) != null) {</span>
<span class="nc" id="L254">                return false;</span>
            }
<span class="nc bnc" id="L256" title="All 2 branches missed.">            if (bdLista.altaLista(dtl, nickCliente)) {</span>
<span class="nc" id="L257">                Lista ld = new ListaDefecto(this.genero.obtener(((DtListaDefecto) dtl).getGenero().getNombre()), dtl.getNombre(), new ArrayList&lt;&gt;(), dtl.getImagen());</span>
<span class="nc" id="L258">                this.listasDefecto.put(ld.getNombre(), (ListaDefecto) ld);</span>
<span class="nc" id="L259">                this.genero.obtener(((DtListaDefecto) dtl).getGenero().getNombre()).cargarLista((ListaDefecto) ld);</span>
<span class="nc" id="L260">                return true;</span>
            } else {
<span class="nc" id="L262">                return false;</span>
            }

        } else {

<span class="nc bnc" id="L267" title="All 2 branches missed.">            if (((Cliente) iUsuario.obtenerUsuario(nickCliente)).getListaParticular(dtl.getNombre()) != null) {</span>
<span class="nc" id="L268">                return false;</span>
            }
<span class="nc bnc" id="L270" title="All 2 branches missed.">            if (bdLista.altaLista(dtl, nickCliente)) {</span>
<span class="nc" id="L271">                Lista lp = new ListaParticular(dtl.getNombre(), dtl.getImagen());</span>
<span class="nc" id="L272">                ((Cliente) iUsuario.obtenerUsuario(nickCliente)).agregarLista(lp);</span>
<span class="nc" id="L273">                return true;</span>
            } else {
<span class="nc" id="L275">                return false;</span>
            }
        }
    }

    @Override
    public void ingresarAlbum(String nom, int anio, ArrayList&lt;String&gt; generos, String img, ArrayList&lt;DtTema&gt; temas) {
<span class="nc" id="L282">        ArrayList&lt;Genero&gt; lstGeneros = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L283">        HashMap&lt;String, Tema&gt; mapTemas = new HashMap&lt;&gt;();</span>

<span class="nc bnc" id="L285" title="All 2 branches missed.">        if (generos.isEmpty()) {</span>
<span class="nc" id="L286">            throw new UnsupportedOperationException(&quot;Debe de indicar al menos un Genero&quot;);</span>
        }

<span class="nc bnc" id="L289" title="All 2 branches missed.">        for (int i = 0; i &lt; generos.size(); i++) {</span>
<span class="nc" id="L290">            String nomG = generos.get(i);</span>
<span class="nc" id="L291">            lstGeneros.add(this.genero.obtener(nomG));</span>
            //mapGeneros.put(nomG, this.genero.obtener(nomG));           

        }

<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (temas.isEmpty()) {</span>
<span class="nc" id="L297">            throw new UnsupportedOperationException(&quot;Debe de indicar al menos un Tema&quot;);</span>
        }

<span class="nc bnc" id="L300" title="All 2 branches missed.">        for (int i = 0; i &lt; temas.size(); i++) {</span>
<span class="nc" id="L301">            DtTema dtT = (DtTema) temas.get(i);</span>
            Tema t;
<span class="nc bnc" id="L303" title="All 2 branches missed.">            if (dtT instanceof DtTemaLocal) {</span>
<span class="nc" id="L304">                t = new TemaLocal(((DtTemaLocal) dtT).getDirectorio(), dtT.getNombre(), dtT.getDuracion(), dtT.getUbicacion());</span>
<span class="nc" id="L305">                mapTemas.put(dtT.getNombre(), t);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">            } else if (dtT instanceof DtTemaRemoto) {</span>
<span class="nc" id="L307">                t = new TemaRemoto(dtT.getNombre(), dtT.getDuracion(), dtT.getUbicacion(), ((DtTemaRemoto) dtT).getUrl());</span>
<span class="nc" id="L308">                mapTemas.put(dtT.getNombre(), t);</span>
            }

        }

<span class="nc" id="L313">        this.artista.ingresarAlbum(nom, anio, lstGeneros, img, mapTemas);</span>

        //set null artista seleccionado
<span class="nc" id="L316">        this.artista = null;</span>
<span class="nc" id="L317">    }</span>

    @Override
    public ArrayList&lt;DtLista&gt; listarLisReproduccionGen(String nomGen) {
<span class="nc" id="L321">        Genero g = this.genero.obtener(nomGen);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">        if (g == null) {</span>
<span class="nc" id="L323">            throw new UnsupportedOperationException(&quot;El genero no existe&quot;);</span>
        }
<span class="nc" id="L325">        this.generoRecordado = g;</span>
<span class="nc" id="L326">        return g.listarLisReproduccion();</span>
    }

    @Override
    public DtLista selecListGen(String nombreL) {
<span class="nc" id="L331">        return generoRecordado.seleccionarLista(nombreL);</span>
    }

    @Override
    public ArrayList&lt;DtTema&gt; selecListaDef(String nombre) {

<span class="nc" id="L337">        ListaDefecto aux = listasDefecto.get(nombre);</span>

<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (aux == null) {</span>
<span class="nc" id="L340">            throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
        }

<span class="nc" id="L343">        ArrayList&lt;DtTema&gt; res = aux.getTemas();</span>

        //if (res.isEmpty()) {
          //  throw new UnsupportedOperationException(&quot;No hay temas en esta lista&quot;);
        //} sino cuando borras un tema de una lista que solo tiene un tema crashea
<span class="nc" id="L348">        return res;</span>
    }

    @Override
    public boolean quitarTema(String nombreT, String nombre, String nombreUser) {
<span class="nc" id="L353">        Cliente u = (Cliente) iUsuario.obtenerUsuario(nombreUser);</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">        if (nombreUser == null) {</span>
<span class="nc" id="L355">            Lista lista = (ListaDefecto) listasDefecto.get(nombre);</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L357">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc" id="L359">            return lista.quitarTema(nombreT);</span>
        } else {
<span class="nc" id="L361">            Lista lista = (ListaParticular) u.getListaParticular(nombre);</span>

<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L364">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L366" title="All 2 branches missed.">            if (u.getLista(nombre).quitarTema(nombreT) /*&amp;&amp; this.quitarTema(nombreT, nombre, nombreUser)*/) {</span>
<span class="nc" id="L367">                return true;</span>
            }
<span class="nc" id="L369">            return false;</span>
        }

    }

    public boolean agregarDeListasDefectoTema(String nombreT, String nombreLista, String nombreUser, String listaDefecto) {
<span class="nc" id="L375">        Cliente u = (Cliente) iUsuario.obtenerUsuario(nombreUser);</span>
<span class="nc" id="L376">        Tema tema = (Tema) listasDefecto.get(listaDefecto).getTema(nombreT);</span>
<span class="nc" id="L377">        BDLista bd = new BDLista();</span>
<span class="nc" id="L378">        CargaDatosPrueba obtenerId = new CargaDatosPrueba();</span>
<span class="nc" id="L379">        int idAlbum = obtenerId.obtenerIdAlbum(tema.getAlbum().getNickArtista(), tema.getAlbum().getNombre());</span>
<span class="nc" id="L380">        int idTema = obtenerId.obtenerIdTema(tema.getAlbum().getNickArtista(), idAlbum, tema.getNombre());</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if (nombreUser.equals(&quot;&quot;)) {</span>
<span class="nc" id="L382">            ListaDefecto lista = (ListaDefecto) listasDefecto.get(nombreLista);</span>
<span class="nc" id="L383">            int idLista = obtenerId.obtenerIdListaDefecto(lista.getGenero().getNombre(), lista.getNombre());</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L385">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L387" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L388">                return true;</span>
            } else {
<span class="nc" id="L390">                return false;</span>
            }

        } else {
<span class="nc" id="L394">            ListaParticular lista = (ListaParticular) u.getListaParticular(nombreLista);</span>
<span class="nc" id="L395">            int idLista = obtenerId.obtenerIdListaParticular(u.getNickname(), lista.getNombre());</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L397">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L399" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L400">                return true;</span>
            } else {
<span class="nc" id="L402">                return false;</span>
            }
        }

    }

    public boolean agregarDeListasParticularesTema(String nombreT, String nombreLista, String nombreUser, String duenio, String listaDelduenio) {
<span class="nc" id="L409">        Cliente u = (Cliente) iUsuario.obtenerUsuario(nombreUser);</span>
<span class="nc" id="L410">        Tema tema = (Tema) ((ListaParticular) ((Cliente) iUsuario.obtenerUsuario(duenio)).getListaParticular(listaDelduenio)).getTema(nombreT);</span>
<span class="nc" id="L411">        BDLista bd = new BDLista();</span>
<span class="nc" id="L412">        CargaDatosPrueba obtenerId = new CargaDatosPrueba();</span>
<span class="nc" id="L413">        int idAlbum = obtenerId.obtenerIdAlbum(tema.getAlbum().getNickArtista(), tema.getAlbum().getNombre());</span>
<span class="nc" id="L414">        int idTema = obtenerId.obtenerIdTema(tema.getAlbum().getNickArtista(), idAlbum, tema.getNombre());</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">        if (nombreUser.equals(&quot;&quot;)) {</span>
<span class="nc" id="L416">            ListaDefecto lista = (ListaDefecto) listasDefecto.get(nombreLista);</span>
<span class="nc" id="L417">            int idLista = obtenerId.obtenerIdListaDefecto(lista.getGenero().getNombre(), lista.getNombre());</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L419">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L421" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L422">                return true;</span>
            } else {
<span class="nc" id="L424">                return false;</span>
            }

        } else {
<span class="nc" id="L428">            Lista lista = (ListaParticular) u.getListaParticular(nombreLista);</span>
<span class="nc" id="L429">            int idLista = obtenerId.obtenerIdListaParticular(u.getNickname(), lista.getNombre());</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L431">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L433" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L434">                return true;</span>
            } else {
<span class="nc" id="L436">                return false;</span>
            }
        }

    }

    public boolean agregarDeAlbumTema(String nombreT, String nombreLista, String nombreUser, String artista, String album) {
<span class="nc" id="L443">        Cliente u = (Cliente) iUsuario.obtenerUsuario(nombreUser);</span>
<span class="nc" id="L444">        Tema tema = (Tema) ((Album) ((Artista) iUsuario.obtenerUsuario(artista)).getAlbum(album)).getTema(nombreT);</span>
<span class="nc" id="L445">        BDLista bd = new BDLista();</span>
<span class="nc" id="L446">        CargaDatosPrueba obtenerId = new CargaDatosPrueba();</span>

<span class="nc" id="L448">        int idAlbum = obtenerId.obtenerIdAlbum(tema.getAlbum().getNickArtista(), tema.getAlbum().getNombre());</span>
<span class="nc" id="L449">        int idTema = obtenerId.obtenerIdTema(tema.getAlbum().getNickArtista(), idAlbum, tema.getNombre());</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if (nombreUser.equals(&quot;&quot;)) {</span>
<span class="nc" id="L451">            ListaDefecto lista = (ListaDefecto) listasDefecto.get(nombreLista);</span>
<span class="nc" id="L452">            int idLista = obtenerId.obtenerIdListaDefecto(lista.getGenero().getNombre(), lista.getNombre());</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L454">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L456" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L457">                return true;</span>
            } else {
<span class="nc" id="L459">                return false;</span>
            }

        } else {
<span class="nc" id="L463">            Lista lista = (ListaParticular) u.getListaParticular(nombreLista);</span>
<span class="nc" id="L464">            int idLista = obtenerId.obtenerIdListaParticular(u.getNickname(), lista.getNombre());</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if (lista == null) {</span>
<span class="nc" id="L466">                throw new UnsupportedOperationException(&quot;No existe la lista&quot;);</span>
            }
<span class="nc bnc" id="L468" title="All 4 branches missed.">            if (lista.agregarTema(tema) &amp;&amp; bd.insertarTemaALista(tema.getAlbum().getNickArtista(), idAlbum, idTema, idLista)) {</span>
<span class="nc" id="L469">                return true;</span>
            } else {
<span class="nc" id="L471">                return false;</span>
            }
        }

    }

    @Override
    public ArrayList&lt;DtTema&gt; selecLista(String nick, String nomL) {
<span class="nc" id="L479">        Cliente us = (Cliente) iUsuario.obtenerUsuario(nick);</span>

<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (us == null) {</span>
<span class="nc" id="L482">            throw new UnsupportedOperationException(&quot;No existe el usuario&quot; + nick + &quot; en el sistema.&quot;);</span>
        }

<span class="nc" id="L485">        Lista lista = us.getLista(nomL);</span>

<span class="nc" id="L487">        ArrayList&lt;DtTema&gt; temas = lista.getTemas();</span>

<span class="nc bnc" id="L489" title="All 2 branches missed.">        if (temas == null) {</span>
<span class="nc" id="L490">            throw new UnsupportedOperationException(&quot;No hay temas en la lista &quot; + nomL + &quot;.&quot;);</span>
        } else {
<span class="nc" id="L492">            return temas;</span>
        }
    }

    @Override
    public boolean publicarLista(String nick, String nomL) {
<span class="nc" id="L498">        Cliente us = (Cliente) iUsuario.obtenerUsuario(nick);</span>
<span class="nc" id="L499">        BDLista bdLista = new BDLista();</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">        if (us == null) {</span>
<span class="nc" id="L501">            throw new UnsupportedOperationException(&quot;No existe el usuario&quot; + nick + &quot; en el sistema.&quot;);</span>
        }

<span class="nc" id="L504">        ListaParticular l = (ListaParticular) us.getLista(nomL);</span>

<span class="nc bnc" id="L506" title="All 2 branches missed.">        if (l == null) {</span>
<span class="nc" id="L507">            throw new UnsupportedOperationException(&quot;No existe la lista&quot; + nomL + &quot; en el sistema.&quot;);</span>
        }

<span class="nc" id="L510">        l.setPrivada(false);</span>
<span class="nc" id="L511">        bdLista.publicarLista(l);</span>
<span class="nc" id="L512">        return true;</span>
    }

    @Override
    public DtGenero selecGenero(String nomGenero) {
<span class="nc" id="L517">        return this.genero.obtener(nomGenero).getData();</span>
    }

    @Override
    public DtAlbumContenido obtenerAlbumContenido(String nomGenero, String nomAlbum, String nickArtista) {
<span class="nc" id="L522">        return genero.obtener(nomGenero).obtenerAlbumContenido(nomAlbum, nickArtista);</span>
    }

    @Override
    public void cargarGenero(String nombre, String padre) {
        // this.genero.agregarGenero(padre.isEmpty() ? genero.getNombre() : padre, nombre);
<span class="fc" id="L528">        genero.agregarGenero(padre, nombre);</span>
<span class="fc" id="L529">    }</span>

    @Override
    public boolean existeGenero(String nombre) {
<span class="fc" id="L533">        return genero.existe(nombre);</span>
    }

    @Override
    public Genero obtenerGenero(String nombre) {
<span class="fc" id="L538">        return genero.obtener(nombre);</span>
    }

    @Override
    public ArrayList&lt;DtLista&gt; listarLisReproduccionDef() {
<span class="nc" id="L543">        ArrayList&lt;DtLista&gt; res = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L545">        Iterator i = listasDefecto.entrySet().iterator();</span>

<span class="nc bnc" id="L547" title="All 2 branches missed.">        while (i.hasNext()) {</span>
<span class="nc" id="L548">            ListaDefecto dtld = (ListaDefecto) ((Map.Entry) i.next()).getValue();</span>
<span class="nc" id="L549">            res.add(dtld.getData());</span>

<span class="nc" id="L551">        }</span>
<span class="nc" id="L552">        return res;</span>

    }

    @Override
    public void cargarLista(ListaDefecto ld, String nombreGenero) {
<span class="fc" id="L558">        genero.obtener(nombreGenero).cargarLista(ld);</span>
<span class="fc" id="L559">        listasDefecto.put(ld.getNombre(), ld);</span>
<span class="fc" id="L560">    }</span>

    @Override
    public void ingresarGenero(String nombre, String padre) {
<span class="nc bnc" id="L564" title="All 2 branches missed.">        if (existeGenero(nombre) == false) {</span>
<span class="nc" id="L565">            genero.agregarGenero(padre, nombre);</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if (!new BDGenero().ingresarGeneros(nombre, padre)) {</span>
<span class="nc" id="L567">                throw new UnsupportedOperationException(&quot;No se pudo ingresar el genero a la BD&quot;);</span>
            }
        } else {
<span class="nc" id="L570">            throw new UnsupportedOperationException(&quot;El genero ya existe&quot;);</span>
        }
<span class="nc" id="L572">    }</span>

    public HashMap&lt;String, Tema&gt; listarTemas(String NombreAlbum, String nickArtista) {
<span class="nc" id="L575">        Album a = iUsuario.selectArtista(nickArtista).getAlbum(NombreAlbum);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">        if (a == null) {</span>
<span class="nc" id="L577">            throw new UnsupportedOperationException(&quot;El Album No Existe&quot;);</span>
        }
<span class="nc" id="L579">        return a.getTemas();</span>
    }

    public ArrayList&lt;DtTema&gt; listarTemasLD(String nombreLista) {
<span class="nc" id="L583">        Lista lista = (Lista) listasDefecto.get(nombreLista);</span>

<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (lista == null) {</span>
<span class="nc" id="L586">            throw new UnsupportedOperationException(&quot;La Lista No Existe&quot;);</span>
        }
<span class="nc" id="L588">        return lista.getTemas();</span>

    }

    public ArrayList&lt;DtTema&gt; listarTemasP(String nombreLista, String nickCliente) {
<span class="nc" id="L593">        Cliente c = (Cliente) iUsuario.obtenerUsuario(nickCliente);</span>
<span class="nc" id="L594">        Lista l = c.getListaParticular(nombreLista);</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">        if (l == null) {</span>
<span class="nc" id="L596">            throw new UnsupportedOperationException(&quot;La Lista No Existe&quot;);</span>
        }
<span class="nc" id="L598">        return l.getTemas();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>